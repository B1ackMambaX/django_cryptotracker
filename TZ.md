# Техническое задание на проект: CryptoFolio

## 1. Цель проекта

Разработка веб-сервиса для трекинга криптовалютного портфеля с автоматическим получением актуальных котировок и расчетом прибыли/убытков. Сервис решает задачу учета криптовалютных инвестиций и позволяет пользователям отслеживать эффективность своих вложений в режиме реального времени.

## 2. Роли пользователей

| Роль | Возможности |
|------|-------------|
| **Гость** | Доступ к страницам регистрации и входа |
| **Авторизованный пользователь** | Ведение личного портфеля, добавление транзакций (покупка/продажа), просмотр аналитики P/L, история операций |
| **Администратор** | Полный доступ к Django Admin, управление пользователями и данными |

## 3. Модели данных (сущности)

### 3.1. Cryptocurrency (Криптовалюта)
Справочник криптовалют с актуальными ценами из CoinGecko API.

| Поле | Тип | Описание |
|------|-----|----------|
| coingecko_id | CharField | Уникальный ID в CoinGecko (например: bitcoin, ethereum) |
| symbol | CharField | Тикер (BTC, ETH) |
| name | CharField | Полное название |
| current_price | DecimalField | Текущая цена в USD |
| image_url | URLField | Ссылка на иконку |
| last_updated | DateTimeField | Время последнего обновления цены |

### 3.2. Portfolio (Портфель)
Позиция пользователя по конкретной криптовалюте.

| Поле | Тип | Описание |
|------|-----|----------|
| user | ForeignKey → User | Владелец портфеля |
| cryptocurrency | ForeignKey → Cryptocurrency | Криптовалюта |
| total_quantity | DecimalField | Общее количество монет |
| avg_buy_price | DecimalField | Средняя цена покупки |
| total_invested | DecimalField | Сумма инвестиций в USD |

**Вычисляемые свойства:**
- `current_value` — текущая стоимость позиции
- `profit_loss` — прибыль/убыток в USD
- `profit_loss_percent` — прибыль/убыток в процентах

### 3.3. Transaction (Транзакция)
История операций покупки и продажи.

| Поле | Тип | Описание |
|------|-----|----------|
| portfolio | ForeignKey → Portfolio | Связь с портфелем |
| transaction_type | CharField | Тип: BUY (покупка) / SELL (продажа) |
| quantity | DecimalField | Количество монет |
| price_per_unit | DecimalField | Цена за единицу на момент сделки |
| total_amount | DecimalField | Общая сумма транзакции |
| notes | TextField | Заметки (опционально) |
| created_at | DateTimeField | Дата и время транзакции |

### Схема связей моделей

```
User (Django)
    │
    ▼ (1:N)
Portfolio ────────► Cryptocurrency
    │                    (N:1)
    ▼ (1:N)
Transaction
```

## 4. Ключевой функционал (User Stories)

### US-1: Регистрация и авторизация
Пользователь может зарегистрироваться с указанием email и пароля, а затем войти в систему для доступа к личному портфелю.

### US-2: Добавление криптовалюты
Пользователь ищет криптовалюту по названию или тикеру (BTC, ETH), выбирает её из результатов поиска и добавляет транзакцию покупки с указанием количества и цены.

### US-3: Учет транзакций
Пользователь может фиксировать операции покупки и продажи криптовалют. При продаже система проверяет достаточность баланса.

### US-4: Просмотр портфеля
На главной странице пользователь видит:
- Список всех своих криптоактивов
- Текущую стоимость каждой позиции
- Прибыль/убыток по каждой монете (в USD и %)
- Общую статистику портфеля

### US-5: Обновление цен в реальном времени
Пользователь может обновить котировки без перезагрузки страницы (AJAX). Цены загружаются из CoinGecko API.

### US-6: История транзакций
Пользователь просматривает полную историю своих операций с сортировкой по дате.

## 5. Внешние интеграции / Аналитика

### CoinGecko API (бесплатный)
- **Endpoint поиска:** `/api/v3/search` — поиск криптовалют по названию
- **Endpoint цен:** `/api/v3/simple/price` — получение текущих котировок
- **Endpoint информации:** `/api/v3/coins/{id}` — детальная информация о монете

**Особенности интеграции:**
- Кэширование запросов (60 секунд) для соблюдения лимитов API
- Bulk-запросы для обновления нескольких цен одновременно
- Обработка ошибок сети и таймаутов

### Аналитика
- Расчет средневзвешенной цены покупки
- Вычисление прибыли/убытка (P/L) в абсолютном и процентном выражении
- Агрегация данных по всему портфелю

## 6. Технический стек

| Компонент | Технология |
|-----------|------------|
| Backend | Python 3.13, Django 4.2 LTS |
| Database | SQLite |
| Frontend | Bootstrap 5.3, Bootstrap Icons |
| API интеграция | requests, CoinGecko API |
| AJAX | Fetch API (vanilla JS) |

## 7. Нефункциональные требования

- Валидация форм на стороне сервера (Django Forms)
- Защита от CSRF-атак
- Соблюдение PEP8
- Деплой на PythonAnywhere
